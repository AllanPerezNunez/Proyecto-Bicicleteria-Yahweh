<!doctype html>
<html lang="es">
<!--========================================================================================-->
<!--                                    HEAD                                                -->
<!--========================================================================================-->    
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahweh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="icon" href="/media/imagenes_bd/yahweh.png" type="image/x-icon">
  
    <style>

      .user-dropdown-hover {
          position: relative;
          display: inline-block;
          background-color: #e50c57;
          color: white;
          padding: 8px 12px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          margin-left:-6%;
      }

      .user-dropdown-content {
          display: none;
          position: absolute;
          background-color: white;
          min-width: 160px;
          right: 0;
          top: 100%;
          box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
          z-index: 1000;
          border-radius: 6px;
          overflow: hidden;
      }

      .user-dropdown-content a,
      .user-dropdown-content button {
          color: black;
          padding: 12px 16px;
          text-decoration: none;
          display: block;
          background: none;
          border: none;
          text-align: left;
          width: 100%;
          cursor: pointer;
      }

      .user-dropdown-content a:hover,
      .user-dropdown-content button:hover {
          background-color: #f1f1f1;
      }

      .user-dropdown-hover:hover .user-dropdown-content {
          display: block;
      }
    

    </style>



  </head>

<!--========================================================================================-->
<!--                                    BODY                                                -->
<!--========================================================================================-->    

  <body>
     <!--===================================================================================-->
    <!--                         BARRA DE NAVEGACIÃ“N: USUARIO NO INICIÃ“ SESIÃ“N             -->
    <!--===================================================================================-->
    <nav class="navbar" aria-label="Light offcanvas navbar" style="background-color: #1ddf1b;position:fixed;top:0;width:100%;z-index:100;">
        <!--Container-->
        <div class="container-fluid">
          <!--[ A1.BOTÃ“N DE CATEGORÃA ]-->
          <button class="navbar-toggler" style="background-color: #e50c57; color: white;" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span><label  style="margin-left: 10px;">MenÃº</label>
          </button>
          <!--[ //A1.BOTÃ“N DE CATEGORÃA ]-->

          <!--[ A2.DESPLIEGUE DEL BOTÃ“N DE CATEGORÃA  ]-->
          <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasWithBothOptionsLabel">
            <!--Titulo CategorÃ­as-->
            <div class="offcanvas-header" >
              <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">MenÃº</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <!--Contenido para mostrar las categorÃ­as-->
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <h5 style="margin-bottom:10px">Categorias</h5>
                  {% for tipoProductos in tipoProductos %}
                  <form action="/filtrarcategoria" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="tipo_producto_id" value="{{ tipoProductos.id }}"> <!--LE ENVÃA DE MANERA OCULTA EL ID acorde a la CategorÃ­a seleccionada-->
                    <button type="submit" style="margin-bottom: 3%;background-color: #ffffff; text-decoration: none; color:black; border-style:solid; border-color:#ffffff; border-width:1px; border-radius:8%;">{{tipoProductos.descripcion}}</button>
                  </form>
                  {% endfor %}
                </li>
              </ul> 
            </div>

          </div>
          <!--[ //A2.DESPLIEGUE DEL BOTÃ“N DE CATEGORÃA  ]-->

          <!--[ A3. YAHWEH TÃTULO ]-->
          <!--url 'mostrarIndex' Permite la Navegabilidad de tal forma que, estando o no el Usuario CONECTADO, no haya errores a la hora del traspaso de datos-->
          <a class="navbar-brand" href="{% url 'mostrarIndex' %}" style="display: flex; align-items: center; text-decoration: none;margin-left:-8%">
            <img src="/media/imagenes_bd/yahweh.png" style="width:40px; height:40px;">
            <h3 style="font-size:20px; color: black;">BicicleterÃ­a Yahweh</h3>
          </a>
          <!--[ //A3. YAHWEH TÃTULO ]--> 

        <div style="display: flex; align-items: center; gap: 10px;">
          <!--[ A4. NAVEGADOR DE BÃšSQUEDA ]-->
          <!--Formulario-->
          <form class="d-flex mt-3" role="search" method="POST" action="/buscador">
            {% csrf_token %}
            <!--BARRA PARA INGRESAR EL PRODUCTO A BUSCAR-->
            <div class="navbar-center">
              <form class="d-flex align-items-center justify-content-center w-100" role="search">
                <div class="input-group" style="width:600px; top:-10px; margin-left:-12%">
                  <input class="form-control" type="search" name="barraBuscador" placeholder="Buscar"aria-label="Search">
                  <button class="btn btn-outline-secondary" type="submit" value="Enviar" name="btnBuscador" style="background-color: #e50c57;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-search" viewBox="0 0 16 16">
                      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 
                        3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 
                        6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                  </button>
                </div>
              </form>
            </div>
            <!--//BOTÃ“N QUE AL PRESIONAR BUSCARÃ EL PRODUCTO(LUPITA)-->

          
            <!--[ A5. "BOTÃ“N" INICIO SESION]--> <!--AparecerÃ¡ solamente si EL USUARIO NO ESTÃ CONECTADO-->
            {% if usuario|length > 0 %}
              {% with usuario as usuario %}
                {% if usuario.0.estadoUsuario_id != 1 %} <!--Si el Estado Usuario EXISTE--> 
                  <button onclick="window.location.href='/Inicio de Sesion'" type="button" class="btn btn-primary m-1" style="width:20%; background-color:#e50c57;font-weight:bold;border:none">
                    Iniciar Sesion
                  </button>
                {% endif %}
              {% endwith %}   
            {% endif%}
            
            <!--[ //A5."BOTÃ“N" INICIO SESION]-->


              <!--A5. {CONDICIÃ“N} EN CASO DE QUE HAYA AL MENOS '1' USUARIO CREADO, MOSTRAR LOS HIPERVÃNCULOS DEL "Historial de Compras" y "Actualizar Usuario"-->
              {% if usuario|length > 0 %} <!--VERIFICA SI LA LISTA TIENE ALMENTOS 2 ELEMENTOS-->
                {% with usuario as usuario %} <!--AquÃ­ nos verifica si hay un usuario, a parte que nos permite referirnos de otra manera al usuario-->
                  {% if usuario.0.estadoUsuario_id == 2 %} <!--Si el Usuario es ""Cliente"" y su Estado_Usuario estÃ¡ "DESCONECTADO"-->
                  <a href="/Inicio de Sesion" style="color:black;"> <!--MOSTRAR EL ÃCONO del CARRITO DE COMPRAS CON HREF A INICIO SESION -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16" style="margin-left:10px;">
                      <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                    </svg>
                  </a>

                  {% else %}<!--En caso Contrario--> 
                  
                  <div class="user-dropdown-hover">
                    <span class="user-name">
                      Hola, {{ usuario.0.nombre }} â–¼
                    </span>
                    <div class="user-dropdown-content">
                      <a href="/perfil_usuario">Mi cuenta</a>
                      <a href="/Historial de Compras">Mis compras</a>
                      <a href="/seguimiento_cliente">Seguimiento</a>
                      <form method="post" action="/cerrar Sesion">
                        {% csrf_token %}
                        <button type="submit">Cerrar sesiÃ³n</button>
                      </form>
                    </div>
                  </div>

                  <a href="/Carrito de Compras" style="color:black;"><!--Mostrar el Carrito de Compras con HREF al Carrito de Compras-->
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16" style="margin-left:10px;">
                      <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                    </svg>
                  </a>

                  {% endif %}
                {% endwith %}
            {% endif %}    
            </form>
          </div>
          <!--//Formulario-->
        </div>
        <!--//container-->
    </nav>
<!--========================================================================================-->
<!--                                  HISTORIAL DE COMPRAS                                  -->
<!--========================================================================================-->   
    <div class="container" style="margin-top: 5%">
        {% if messages %}
            <ul class="messages list-unstyled">
                {% for message in messages %}
                    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                        {% if message.tags == 'success' %}
                            <strong>Â¡Felicidades!</strong>
                        {% elif message.tags == 'error' %}
                            <strong>Â¡Error!</strong>
                        {% elif message.tags == 'info' %}
                            <strong>InformaciÃ³n:</strong>
                        {% elif message.tags == 'warning' %}
                            <strong>Advertencia:</strong>
                        {% else %}
                            <strong>Mensaje:</strong>
                        {% endif %}
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    <div class="container" style="margin-top:7%;"> <!--Container Historial de Compras-->
      <h1 class="text-center" style="margin-bottom:3%;">Historial de Compras</h1>
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0" style="border:2px solid #e50c57;margin-bottom:5%;width:110%;margin-left:-5%;"> <!--H2.-Tabla Historial-->
          <table border="1" class="table text-center" >
          <tr bgcolor="#e50c57" style="color:white;">
              <th>Id</th>
              <th>Usuario</th>
              <th>Compra</th>
              <th>Precio</th>
              <th>Unidades Compradas</th>
              <th>Fecha de la Compra</th>
              <th>DirecciÃ³n</th>
              <th>Tipo de Tarjeta</th>
              <th>Estado</th> <!--Comprado-->
          </tr>

          {% for compra in compras %}
          <tr>
              <td>{{ compra.id }}</td>
              <td>{{ compra.usuario__rut }}</td>
              <td>{{ compra.producto__nombre }}</td>
              <td>{{ compra.producto__precio }}</td>
              <td>{{ compra.cantidad }}</td>
              <td>{{ compra.fecha_compra }}</td>
              <td>{{ compra.direccion }}</td>
              <td>{{ compra.tarjeta__tipoTarjeta__tipo }}</td>
              <th>{{ compra.estado_compra }}</th>
          </tr>
          {% empty %}
          <tr><td colspan="8">No hay historial de compras para este usuario.</td></tr>
          {% endfor %}

          </table>

      </div><!--H2.-Tabla Historial-->

    </div><!--//H1.-Container Historial de Compras-->
    <footer style="background-color: #e50c57; color:white; padding: 20px 0; text-align: center; margin-top: 19%;">
      <div style="max-width: 1200px; margin: auto;">
        <p style="margin: 5px 0;">
          ðŸ“§ Â¿Dudas o consultas? EscrÃ­benos a 
          <a href="mailto:magdalena.nunez16256@gmail.com" style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            magdalena.nunez16256@gmail.com
          </a>
        </p>

        <p style="margin: 5px 0;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
            <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/>
          </svg> Contacteme desde
          <a href="https://wa.me/56953082556" 
            target="_blank" 
            style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            +56 9 5308 2556
          </a>
        </p>

        <p style="margin: 5px 0;">
          ðŸ“· SÃ­guenos en 
          <a href="https://www.instagram.com/bicicleteria_yhwh/?igsh=Y3JvbmZxMThoZDBq#" 
            target="_blank" 
            style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            @bicicleteria_yhwh
          </a>
        </p>

        <p style="margin-top: 10px; font-size: 0.9em; color: #bbb;">
          &copy; {{ year|default:"2025" }} BicicleterÃ­a Yahweh. Todos los derechos reservados.
        </p>
      </div>
    </footer>

    


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> 
  </body>
  
</html>