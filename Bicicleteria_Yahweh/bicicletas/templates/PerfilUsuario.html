<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahweh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="icon" href="/media/imagenes_bd/yahweh.png" type="image/x-icon">
    
    <style>
    /* Estilo por defecto para pantallas grandes (computadores, laptops) */
        .alerta-login-error {
            margin-top: 4%; /* Margen para pantallas grandes */
        }

        /* Media Query para dispositivos m√≥viles (ej. ancho de pantalla de 768px o menos) */
        @media (max-width: 768px) {
            .alerta-login-error {
                margin-top: 13%; /* Margen superior m√°s grande para m√≥viles */
            }
        }

        /* Opcional: Otra Media Query para pantallas a√∫n m√°s peque√±as si lo necesitas */
        @media (max-width: 480px) {
            .alerta-login-error {
                margin-top: 10%; /* Margen para celulares muy peque√±os */
            }
        }

      .user-dropdown-hover {
          position: relative;
          display: inline-block;
          background-color: #e50c57;
          color: white;
          padding: 8px 12px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          margin-left:-6%;
      }

      .user-dropdown-content {
          display: none;
          position: absolute;
          background-color: white;
          min-width: 160px;
          right: 0;
          top: 100%;
          box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
          z-index: 1000;
          border-radius: 6px;
          overflow: hidden;
      }

      .user-dropdown-content a,
      .user-dropdown-content button {
          color: black;
          padding: 12px 16px;
          text-decoration: none;
          display: block;
          background: none;
          border: none;
          text-align: left;
          width: 100%;
          cursor: pointer;
      }

      .user-dropdown-content a:hover,
      .user-dropdown-content button:hover {
          background-color: #f1f1f1;
      }

      .user-dropdown-hover:hover .user-dropdown-content {
          display: block;
      }
      </style>
    </head>


  <body>
    <!--===================================================================================-->
    <!--                         BARRA DE NAVEGACI√ìN: USUARIO NO INICI√ì SESI√ìN             -->
    <!--===================================================================================-->
    <nav class="navbar" aria-label="Light offcanvas navbar" style="background-color: #1ddf1b;position:fixed;top:0;width:100%;z-index:100;">
        <!--Container-->
        <div class="container-fluid">
          <!--[ A1.BOT√ìN DE CATEGOR√çA ]-->
          <button class="navbar-toggler" style="background-color: #e50c57; color: white;" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span><label  style="margin-left: 10px;">Men√∫</label>
          </button>
          <!--[ //A1.BOT√ìN DE CATEGOR√çA ]-->

          <!--[ A2.DESPLIEGUE DEL BOT√ìN DE CATEGOR√çA  ]-->
          <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasWithBothOptionsLabel">
            <!--Titulo Categor√≠as-->
            <div class="offcanvas-header" >
              <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Men√∫</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <!--Contenido para mostrar las categor√≠as-->
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <h5 style="margin-bottom:10px">Categorias</h5>
                  {% for tipoProductos in tipoProductos %}
                  <form action="/filtrarcategoria" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="tipo_producto_id" value="{{ tipoProductos.id }}"> <!--LE ENV√çA DE MANERA OCULTA EL ID acorde a la Categor√≠a seleccionada-->
                    <button type="submit" style="margin-bottom: 3%;background-color: #ffffff; text-decoration: none; color:black; border-style:solid; border-color:#ffffff; border-width:1px; border-radius:8%;">{{tipoProductos.descripcion}}</button>
                  </form>
                  {% endfor %}
                </li>
              </ul> 
            </div>

          </div>
          <!--[ //A2.DESPLIEGUE DEL BOT√ìN DE CATEGOR√çA  ]-->

          <!--[ A3. YAHWEH T√çTULO ]-->
          <!--url 'mostrarIndex' Permite la Navegabilidad de tal forma que, estando o no el Usuario CONECTADO, no haya errores a la hora del traspaso de datos-->
          <a class="navbar-brand" href="{% url 'mostrarIndex' %}" style="display: flex; align-items: center; text-decoration: none;margin-left:-8%">
            <img src="/media/imagenes_bd/yahweh.png" style="width:40px; height:40px;">
            <h3 style="font-size:20px; color: black;">Bicicleter√≠a Yahweh</h3>
          </a>
          <!--[ //A3. YAHWEH T√çTULO ]--> 

        <div style="display: flex; align-items: center; gap: 10px;">
          <!--[ A4. NAVEGADOR DE B√öSQUEDA ]-->
          <!--Formulario-->
          <form class="d-flex mt-3" role="search" method="POST" action="/buscador">
            {% csrf_token %}
            <!--BARRA PARA INGRESAR EL PRODUCTO A BUSCAR-->
            <div class="navbar-center">
              <form class="d-flex align-items-center justify-content-center w-100" role="search">
                <div class="input-group" style="width:600px; top:-10px; margin-left:-12%">
                  <input class="form-control" type="search" name="barraBuscador" placeholder="Buscar"aria-label="Search">
                  <button class="btn btn-outline-secondary" type="submit" value="Enviar" name="btnBuscador" style="background-color: #e50c57;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-search" viewBox="0 0 16 16">
                      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 
                        3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 
                        6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                  </button>
                </div>
              </form>
            </div>
            <!--//BOT√ìN QUE AL PRESIONAR BUSCAR√Å EL PRODUCTO(LUPITA)-->

          
            <!--[ A5. "BOT√ìN" INICIO SESION]--> <!--Aparecer√° solamente si EL USUARIO NO EST√Å CONECTADO-->
            {% if usuario|length > 0 %}
              {% with usuario as usuario %}
                {% if usuario.0.estadoUsuario_id != 1 %} <!--Si el Estado Usuario EXISTE--> 
                  <button onclick="window.location.href='/Inicio de Sesion'" type="button" class="btn btn-primary m-1" style="width:20%; background-color:#e50c57;font-weight:bold;border:none">
                    Iniciar Sesion
                  </button>
                {% endif %}
              {% endwith %}   
            {% endif%}
            
            <!--[ //A5."BOT√ìN" INICIO SESION]-->


              <!--A5. {CONDICI√ìN} EN CASO DE QUE HAYA AL MENOS '1' USUARIO CREADO, MOSTRAR LOS HIPERV√çNCULOS DEL "Historial de Compras" y "Actualizar Usuario"-->
              {% if usuario|length > 0 %} <!--VERIFICA SI LA LISTA TIENE ALMENTOS 2 ELEMENTOS-->
                {% with usuario as usuario %} <!--Aqu√≠ nos verifica si hay un usuario, a parte que nos permite referirnos de otra manera al usuario-->
                  {% if usuario.0.estadoUsuario_id == 2 %} <!--Si el Usuario es ""Cliente"" y su Estado_Usuario est√° "DESCONECTADO"-->
                  <a href="/Inicio de Sesion" style="color:black;"> <!--MOSTRAR EL √çCONO del CARRITO DE COMPRAS CON HREF A INICIO SESION -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16" style="margin-left:10px;">
                      <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                    </svg>
                  </a>

                  {% else %}<!--En caso Contrario--> 
                  
                  <div class="user-dropdown-hover">
                    <span class="user-name">
                      Hola, {{ usuario.0.nombre }} ‚ñº
                    </span>
                    <div class="user-dropdown-content">
                      <a href="/perfil_usuario">Mi cuenta</a>
                      <a href="/Historial de Compras">Mis compras</a>
                      <a href="/seguimiento_cliente">Seguimiento</a>
                      <form method="post" action="/cerrar Sesion">
                        {% csrf_token %}
                        <button type="submit">Cerrar sesi√≥n</button>
                      </form>
                    </div>
                  </div>

                  <a href="/Carrito de Compras" style="color:black;"><!--Mostrar el Carrito de Compras con HREF al Carrito de Compras-->
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16" style="margin-left:10px;">
                      <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                    </svg>
                  </a>

                  {% endif %}
                {% endwith %}
            {% endif %}    
            </form>
          </div>
          <!--//Formulario-->
        </div>
        <!--//container-->
    </nav>

<!--========================================================================================-->
<!--                                  PERFIL DE USUARIO                                     -->
<!--========================================================================================-->  
    
    
      <div class="container" style="border:2px solid #1ddf1b;padding:20px;margin-top:7%;margin-bottom:5%;">
      <form style="padding: 10px;" action="{% url 'actualizar_usuario' %}" method="post">
          {% csrf_token %}

            <div class="container" style="margin-top:3%">
              {% if messages %}
                  <ul class="messages list-unstyled">
                      {% for message in messages %}
                          <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                              {% if message.tags == 'success' %}
                                  <strong>¬°Felicidades!</strong>
                              {% elif message.tags == 'error' %}
                                  <strong>¬°Error!</strong>
                              {% elif message.tags == 'info' %}
                                  <strong>Informaci√≥n:</strong>
                              {% elif message.tags == 'warning' %}
                                  <strong>Advertencia:</strong>
                              {% else %}
                                  <strong>Mensaje:</strong>
                              {% endif %}
                              {{ message }}
                              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                          </div>
                      {% endfor %}
                  </ul>
              {% endif %}
          </div>

          <div class="row">
              <div class="col-4 mb-3">
                  <label for="rutcli2" class="form-label">Rut(En caso de ser "-K", reempl√°celo con un "-0")</label>
                  <input type="text" class="form-control" id="rutcli2" maxlength="12" name="rutcli2" value="{{ usuario.0.rut|safe }}" placeholder="Ingrese su Rut" disabled>
                  <span id="rutErrorMessage" style="color: red;"></span>
              </div>
              <script>
                  // Tu script de validaci√≥n de RUT actual
                  var rutInput = document.getElementById("rutcli2");
                  var errorMessage = document.getElementById("rutErrorMessage");

                  rutInput.addEventListener("input", function() {
                      var rut = this.value.replace(/[^\d]/g, "");
                      if (rut !== "" && parseInt(rut, 10) <= 99999999) {
                          errorMessage.textContent = "El RUT debe ser mayor a 00.999.999-9";
                      } else {
                          errorMessage.textContent = "";
                      }
                      var formattedRut = "";
                      for (var i = 0; i < rut.length; i++) {
                          if (i === 2 || i === 5) {
                              formattedRut += ".";
                          } else if (i === 8) {
                              formattedRut += "-";
                          }
                          formattedRut += rut[i];
                      }
                      this.value = formattedRut;
                  });
              </script>
              <div class="col-4 mb-3">
                  <label for="nomcli2" class="form-label">Nombre</label>
                  <input type="text" class="form-control" id="nomcli2" name="nomcli2" maxlength="20" value="{{ usuario.0.nombre |safe }}" placeholder="Ingrese su Nombre" required>
              </div>
              <div class="col-4 mb-3">
                  <label for="apecli2" class="form-label">Apellido</label>
                  <input type="text" class="form-control" id="apecli2" name="apecli2" maxlength="20" value="{{ usuario.0.apellido|safe }}" placeholder="Ingrese su Apellido" required>
              </div>
          </div>

          <div class="mb-3">
              <label for="emacli2" class="form-label">Email</label>
              <input type="email" class="form-control" id="emacli2" name="emacli2" maxlength="100" value="{{ usuario.0.correo }}" placeholder="Ingrese su Email" required>
              <input type="hidden" id="original_emacli2" value="{{ usuario.0.correo }}">
          </div>

          <div class="mb-3">
              <label for="foncli2" class="form-label">Tel√©fono</label>
              <input type="tel" class="form-control" id="foncli2" name="foncli2" value="{{ usuario.0.telefono }}" placeholder="Ingrese su N√∫mero de tel√©fono" required maxlength="11" pattern="[0-9]{1,11}" title="Ingrese solo n√∫meros">
              <input type="hidden" id="original_foncli2" value="{{ usuario.0.telefono }}">
          </div>

          <div class="mb-3" id="currentPasswordField" style="display: none;">
              <label for="current_password" class="form-label">Contrase√±a Actual (para cambios de Email/Tel√©fono)</label>
              <input type="password" class="form-control" id="current_password" name="current_password" placeholder="Ingrese su contrase√±a actual">
          </div>

          <button type="submit" class="btn btn-primary" style="margin-left:auto; margin-right:auto; display: block;background-color:#1ddf1b;border:none;font-weight:bold;">Modificar Perfil</button>
      </form>

      <div class="text-center mb-4">
          <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#changePasswordModal" style="background-color:#e50c57;border:none;font-weight:bold;">
              Cambiar Contrase√±a
          </button>
      </div>


    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="changePasswordModalLabel">Cambiar Contrase√±a</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'cambiar_contrasena' %}" method="post">
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="old_password" class="form-label">Contrase√±a Actual</label>
                                <input type="password" class="form-control" id="old_password" name="old_password" required>
                            </div>
                            <div class="mb-3">
                                <label for="new_password1" class="form-label">Nueva Contrase√±a</label>
                                <input type="password" class="form-control" id="new_password1" name="new_password1" required>
                            </div>
                            <div class="mb-3">
                                <label for="new_password2" class="form-label">Confirmar Nueva Contrase√±a</label>
                                <input type="password" class="form-control" id="new_password2" name="new_password2" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color:#e50c57;border:none;font-weight:bold;">Cancelar</button>
                            <button type="submit" class="btn btn-primary" style="background-color:#1ddf1b;border:none;font-weight:bold;">Guardar Nueva Contrase√±a</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        var emailInput = document.getElementById('emacli2');
        var phoneInput = document.getElementById('foncli2');
        var originalEmail = document.getElementById('original_emacli2').value;
        var originalPhone = document.getElementById('original_foncli2').value;
        var currentPasswordFieldDiv = document.getElementById('currentPasswordField');
        var currentPasswordInput = document.getElementById('current_password');

        function toggleCurrentPasswordField() {
            if (emailInput.value !== originalEmail || phoneInput.value !== originalPhone) {
                currentPasswordFieldDiv.style.display = 'block'; // Mostrar el campo
                currentPasswordInput.setAttribute('required', 'required'); // Hacerlo requerido
            } else {
                currentPasswordFieldDiv.style.display = 'none'; // Ocultar el campo
                currentPasswordInput.removeAttribute('required'); // No requerido
                currentPasswordInput.value = ''; // Limpiar el valor por seguridad
            }
        }

        // Escuchar cambios en los campos de Email y Tel√©fono
        emailInput.addEventListener('input', toggleCurrentPasswordField);
        phoneInput.addEventListener('input', toggleCurrentPasswordField);

        // Ejecutar al cargar la p√°gina por si los valores ya est√°n modificados (ej. autocompletado del navegador)
        toggleCurrentPasswordField();
    });
  </script>
    
    
    
    
    
    <footer style="background-color: #e50c57; color:white; padding: 20px 0; text-align: center;">
      <div style="max-width: 1200px; margin: auto;">
        <p style="margin: 5px 0;">
          üìß ¬øDudas o consultas? Escr√≠benos a 
          <a href="mailto:magdalena.nunez16256@gmail.com" style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            magdalena.nunez16256@gmail.com
          </a>
        </p>

        <p style="margin: 5px 0;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
            <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/>
          </svg> Contacteme desde
          <a href="https://wa.me/56953082556" 
            target="_blank" 
            style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            +56 9 5308 2556
          </a>
        </p>

        <p style="margin: 5px 0;">
          üì∑ S√≠guenos en 
          <a href="https://www.instagram.com/bicicleteria_yhwh/?igsh=Y3JvbmZxMThoZDBq#" 
            target="_blank" 
            style="color:#1ddf1b; text-decoration: none;font-weight:bold;">
            @bicicleteria_yhwh
          </a>
        </p>

        <p style="margin-top: 10px; font-size: 0.9em; color: #bbb;">
          &copy; {{ year|default:"2025" }} Bicicleter√≠a Yahweh. Todos los derechos reservados.
        </p>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>

</html>